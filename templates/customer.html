<!DOCTYPE html>
<html>
<head>
  <title>Shopify Customer Support</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <style>
    body { background: #111; color: #eee; font-family: Arial, sans-serif; margin:0; }
    header { background: #222; padding: 12px; text-align: center; font-size: 18px; font-weight: bold; }
    #chat { padding: 10px; max-height: 70vh; overflow-y: auto; }
    .msg { margin: 8px 0; padding: 10px; border-radius: 12px; max-width: 75%; word-wrap: break-word; }
    .me { background: #444; margin-left: auto; }
    .them { background: #2a2a2a; margin-right: auto; }
    #input-area { position: fixed; bottom: 0; width: 100%; display: flex; background: #222; padding: 10px; }
    #message { flex: 1; padding: 8px; border-radius: 8px; border: none; }
    button { background: #555; color: #fff; border: none; padding: 10px; border-radius: 8px; margin-left: 6px; }
  </style>
</head>
<body>
  <header>Shopify Customer Support</header>
  <div id="chat">
    {% for sender, msg, time in messages %}
      <div class="msg {% if sender == customer_name %}me{% else %}them{% endif %}">
        <b>{{ sender }}</b>: {{ msg }} <br><small>{{ time }}</small>
      </div>
    {% endfor %}
  </div>
  <div id="input-area">
    <input type="text" id="message" placeholder="Type a message...">
    <button onclick="sendMessage()">Send</button>
  </div>

<script>
  var socket = io();
  var name = "{{ customer_name }}";

  socket.emit("join", {name: name});

  function sendMessage() {
    let msg = document.getElementById("message").value;
    if(msg.trim() === "") return;
    socket.emit("send_message", {sender: name, receiver: "admin", message: msg});
    document.getElementById("message").value = "";
  }

  socket.on("receive_message", function(data) {
    let div = document.createElement("div");
    div.className = "msg " + (data.sender === name ? "me" : "them");
    div.innerHTML = `<b>${data.sender}</b>: ${data.message}`;
    document.getElementById("chat").appendChild(div);
  });
</script>
</body>
</html>
