<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <style>
    body { background: #111; color: #eee; font-family: Arial, sans-serif; margin:0; display:flex; height:100vh; }
    #customers { width: 25%; background:#222; padding: 10px; overflow-y: auto; }
    #chat-area { flex: 1; display:flex; flex-direction:column; }
    header { background: #222; padding: 12px; text-align: center; font-weight: bold; }
    #chat { flex: 1; padding: 10px; overflow-y: auto; }
    .msg { margin: 8px 0; padding: 10px; border-radius: 12px; max-width: 75%; word-wrap: break-word; }
    .me { background: #444; margin-left: auto; }
    .them { background: #2a2a2a; margin-right: auto; }
    #input-area { display:flex; padding: 10px; background:#222; }
    #message { flex:1; padding:8px; border-radius:8px; border:none; }
    button { background:#555; color:#fff; border:none; padding:10px; border-radius:8px; margin-left:6px; }
  </style>
</head>
<body>
  <div id="customers">
    <h3>Active Customers</h3>
    <ul id="customer-list">
      {% for c in customers %}
        <li onclick="selectCustomer('{{ c }}')">{{ c }}</li>
      {% endfor %}
    </ul>
  </div>
  <div id="chat-area">
    <header>Admin Dashboard</header>
    <div id="chat"></div>
    <div id="input-area">
      <input type="text" id="message" placeholder="Type a message...">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

<script>
  var socket = io();
  var currentCustomer = null;

  socket.emit("join", {name: "admin"});

  function selectCustomer(cust) {
    currentCustomer = cust;
    document.getElementById("chat").innerHTML = "";
    // TODO: fetch old messages via AJAX if needed
  }

  function sendMessage() {
    if(!currentCustomer) return alert("Select a customer first!");
    let msg = document.getElementById("message").value;
    if(msg.trim() === "") return;
    socket.emit("send_message", {sender: "admin", receiver: currentCustomer, message: msg});
    document.getElementById("message").value = "";
  }

  socket.on("receive_message", function(data) {
    if(data.sender === currentCustomer || data.receiver === currentCustomer) {
      let div = document.createElement("div");
      div.className = "msg " + (data.sender === "admin" ? "me" : "them");
      div.innerHTML = `<b>${data.sender}</b>: ${data.message}`;
      document.getElementById("chat").appendChild(div);
    }
  });

  socket.on("active_customers", function(data) {
    let list = document.getElementById("customer-list");
    list.innerHTML = "";
    data.customers.forEach(c => {
      let li = document.createElement("li");
      li.innerText = c;
      li.onclick = () => selectCustomer(c);
      list.appendChild(li);
    });
  });
</script>
</body>
</html>
